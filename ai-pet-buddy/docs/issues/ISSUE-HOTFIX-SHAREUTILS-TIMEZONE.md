# Hotfix: `shareUtils.ts` におけるタイムゾーン処理のバグ修正 (Hotfix: Fix Timezone Handling Bug in `shareUtils.ts`)

## 概要 (Overview)
`src/utils/shareUtils.ts` 内の共有機能に関連する日時処理において、タイムゾーンの扱いにバグが存在する可能性が高いです。これにより、`shareUtils.test.ts` の一部テストが失敗しています。共有される情報の日時がユーザーの期待と異なるタイムゾーンで表示されたり、誤った日時として解釈されたりする問題を防ぐため、このバグを修正する必要があります。

## 発生条件・再現手順 (Conditions / Steps to Reproduce)
1. ターミナルで `cd /Users/suzukiwataru/src/my-vibe-coding/ai-pet-buddy` を実行。
2. `npm run test:run` を実行。
3. `shareUtils.test.ts` に関連するテストで、日時処理に関するアサーションが失敗することを確認。

## 期待される動作 (Expected Behavior)
- `shareUtils.ts` におけるタイムゾーン関連のバグが修正される。
- `shareUtils.test.ts` のすべてのテストが成功する。
- 共有機能を通じて生成・表示される日時情報が、意図した通り（例: UTC基準で保存・処理し、表示時にユーザーのローカルタイムゾーンに適切に変換される、または特定のタイムゾーンで一貫して表示される）になる。

## 現在の動作 (Current Behavior)
`shareUtils.test.ts` のテスト結果から、日時が期待されるタイムゾーンやオフセットで処理されていない、またはフォーマットされていないことが示唆される。

## 関連ファイル (Relevant Files)
- `src/utils/shareUtils.ts`
- `src/utils/shareUtils.test.ts`
- 日時処理ライブラリを使用している場合、そのライブラリ (例: `date-fns`, `dayjs`, `luxon`)
- 関連する型定義ファイル (もしあれば)

## 開発者向け指示 (Instructions for AI Agent)
- **優先度 (Priority):** High
- **目標 (Goal):** `shareUtils.ts` のタイムゾーン関連のバグを修正し、`shareUtils.test.ts` がすべて成功するようにする。日時は原則としてUTCで内部処理し、必要に応じて表示時に適切なタイムゾーンに変換する方針を推奨する。
- **具体的なタスク (Specific Tasks):**
    1. **エラー分析:** `shareUtils.test.ts` の失敗しているテストケースを詳細に分析し、どの関数でどのようなタイムゾーンの問題（オフセットの誤り、誤った変換、夏時間の考慮漏れなど）が発生しているかを特定する。
    2. **`shareUtils.ts` のレビュー:**
        - 日時を生成、操作、フォーマットしている箇所を特定する。
        - `Date`オブジェクトを直接操作している場合、その挙動（特にタイムゾーンに関してブラウザやNode.js環境に依存する部分）を理解する。
        - 日時処理ライブラリを使用している場合、そのAPI（タイムゾーン設定、変換関数など）が正しく使用されているか確認する。
    3. **タイムゾーン戦略の確認:** プロジェクトとしての日時処理戦略（例: 全てUTCで扱い表示時に変換、サーバータイムゾーンに合わせる等）があればそれに従う。なければ、UTC基準での処理を基本とする。
    4. **修正適用:** 特定された問題を修正する。例えば、日時文字列をパースする際にタイムゾーン情報を明示的に扱う、日時オブジェクトを生成する際にUTCを指定する、表示フォーマット時にタイムゾーン変換を行うなどの対応が考えられる。
    5. **テスト実行とデバッグ:** `npm run test:run` を実行し、`shareUtils.test.ts` のテストがすべてパスすることを確認する。失敗する場合は、デバッグを行い修正を繰り返す。
- **考慮事項 (Considerations):**
    - JavaScriptの `Date` オブジェクトは扱いに注意が必要です。多くの場合、`Date.prototype.toString()` はローカルタイムゾーンを返し、`Date.prototype.toISOString()` はUTCを返します。
    - 日時処理ライブラリ（`date-fns-tz`, `dayjs` の timezone plugin など）は、タイムゾーン処理をより堅牢かつ簡単にするために役立ちます。導入されていない場合は、部分的な導入も検討可能です（ただし、大規模な変更は慎重に）。
    - テストケースでは、異なるタイムゾーンや、夏時間と標準時の切り替わり付近など、境界条件を考慮することが重要です。
    - サーバーとの間で日時データをやり取りする場合、ISO 8601形式のUTC文字列 (`YYYY-MM-DDTHH:mm:ss.sssZ`) を使用することが一般的です。
- **テスト要件 (Testing Requirements):**
    - `shareUtils.test.ts` の既存テストがすべてパスすること。
    - 修正により影響を受ける可能性のある箇所について、タイムゾーンの境界ケース（例: UTC+0、UTC+9、UTC-5、日付変更線付近、夏時間切り替わり）を考慮したテストケースを追加することが望ましい。
    - テスト内でタイムゾーンをモックする必要がある場合は、`vitest.useFakeTimers()` や日時ライブラリのモック機能を利用する。
- **完了条件 (Acceptance Criteria):**
    - `shareUtils.test.ts` のすべてのテストが成功する。
    - 共有機能で扱われる日時が、異なるタイムゾーンのユーザーに対しても、意図通り正確に処理・表示される。
    - コード変更は、既存のESLintルールおよびプロジェクトのコーディング規約に準拠する。

## 参照情報 (References)
- MDN: `Date` object
- 使用している日時ライブラリのドキュメント (例: `date-fns`, `dayjs`)
- IANA Time Zone Database
